on:
  push:
    branches:
      - deploy
name: üìü Deploy Fiel da Sorte FTP Production
defaults:
  run:
    working-directory: ./
jobs:
  web-deploy:
    name: üéâ Deploy
    runs-on: ubuntu-latest
    steps:
      - name: üöö Get latest code
        uses: actions/checkout@v2

      - name: üî´ Use Node.js 18
        uses: actions/setup-node@v2
        with:
          node-version: "18"

      - name: Install dependencies
        run: npm install

      - name: Create .env file
        run: |
          touch .env
          echo PORT_DB=${{ secrets.ENV_FIELDASORTE }} >> .env
          cat .env

      - name: Load environment variables from .env
        run: source .env

      - name: ‚õè Build Project
        run: |
          npm run build

      - name: ‚úî List output files
        run: ls

      - name: üåé Sync files to FTP
        uses: SamKirkland/FTP-Deploy-Action@4.3.0
        with:
          server: 35.199.123.44
          username: tcp.mag3s.com_github
          password: ${{ secrets.PASS_FTP_FIELDASORTE }}
          local-dir: ./.output/
          server-dir: /
          exclude: |
            **/.well-known/**
            **/cgi-bin/**
            .ftpquota
            .htaccess
          dry-run: false

      # - name: üì§ Send Message Telegram Deploy
      #   uses: appleboy/telegram-action@master
      #   with:
      #     to: ${{ secrets.TELEGRAM_TO }}
      #     token: ${{ secrets.TELEGRAM_TOKEN }}
      #     message: |
      #       Commit criado por: ${{ github.actor }}!
      #       O que foi feito: ${{ github.event.commits[0].message }}

      #       Ambiente: site de produ√ß√£o ‚û° https://www.galera.bet

      #       Veja mais detalhes em: https://github.com/${{ github.repository }}/commit/${{github.sha}}
      #     disable_web_page_preview: true
